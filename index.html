<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>敬拜歌譜查詢</title>
  <script src="https://unpkg.com/vue@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input { width: 300px; padding: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background-color: #f0f0f0; text-align: center; }
    th:first-child, td:first-child { width: 30px; text-align: center; }
    td.lyrics { width: 30%; word-break: break-word; }
  </style>
</head>
<body>
  <div id="app">
    <h1>敬拜歌譜查詢</h1>
    <input v-model="search" placeholder="輸入歌名關鍵字">

    <table v-if="filteredSongs.length">
      <thead>
        <tr>
          <th><input type="checkbox" @click="toggleAll"></th>
          <th v-for="header in headers" :key="header">{{ header }}</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(song, index) in filteredSongs" :key="song[headers[0]]">
          <td><input type="checkbox" v-model="selected[index]" /></td>
          <td v-for="header in headers" :key="header" :class="{ 'lyrics': header === '歌詞' }">
            <template v-if="header === 'YouTube'">
              <a v-if="song[header]" :href="song[header]" target="_blank">YouTube 連結</a>
              <span v-else>-</span>
            </template>
            <template v-else>
              {{ song[header] }}
            </template>
          </td>
        </tr>
      </tbody>
    </table>
    <p v-else>查無資料</p>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          search: '',
          songs: [],
          headers: [],
          selected: []
        };
      },
      computed: {
        filteredSongs() {
          const keyword = this.search.trim().toLowerCase();
          let result = this.songs;
          if (keyword) {
            result = this.songs.filter(song => {
              return Object.values(song).some(value =>
                String(value).toLowerCase().includes(keyword)
              );
            });
          }
          return result.sort((a, b) => {
            const key = '歌名';
            return (a[key] || '').localeCompare(b[key] || '');
          });
        }
      },
      methods: {
        toggleAll(e) {
          const isChecked = e.target.checked;
          this.selected = this.filteredSongs.map(() => isChecked);
        }
      },
      mounted() {
        const url = 'https://opensheet.elk.sh/1fZIE67QV7fBbKonS2TzUp3kY8GPuDdG1EYDf5d1C_t8/\u6b4c\u66f2\u6e05\u55ae';
        axios.get(url).then(response => {
          const rows = response.data;
          if (rows.length > 0) {
            this.headers = Object.keys(rows[0]);
            this.songs = rows;
            this.selected = new Array(rows.length).fill(false);
          }
        }).catch(error => {
          console.error('讀取 Google Sheet 失敗:', error);
        });
      }
    }).mount('#app');
  </script>
</body>
</html>
